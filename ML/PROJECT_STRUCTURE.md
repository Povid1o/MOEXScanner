# üìÅ –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê ML
## Senior ML Developer & Project Manager Documentation

**–í–µ—Ä—Å–∏—è:** 2.0  
**–î–∞—Ç–∞:** 2025-12-03  
**–ê–≤—Ç–æ—Ä:** ML Pipeline Architecture Review

---

## üéØ –û–ë–ó–û–† –ê–†–•–ò–¢–ï–ö–¢–£–†–´

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ **–¥–≤–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–∞–ø–æ–∫**:

1. **–ü–∞–ø–∫–∏ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ (01-06)** ‚Äî –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ notebooks (Jupyter)
2. **–ü–∞–ø–∫–∏ –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤** ‚Äî production –º–æ–¥—É–ª–∏ (Python –ø–∞–∫–µ—Ç—ã)

**–ü—Ä–∏–Ω—Ü–∏–ø:** Notebooks –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ ‚Üí –ú–æ–¥—É–ª–∏ –¥–ª—è production

---

# üìÇ –ü–ê–ü–ö–ò –° –ò–ù–î–ï–ö–°–ê–ú–ò (–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ Notebooks)

## `01_data_loading.ipynb` ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### üì• –í–•–û–î:
- **–ò—Å—Ç–æ—á–Ω–∏–∫:** `data/MOEX_DATA/{TICKER}/1D/*.csv`
- **–§–æ—Ä–º–∞—Ç:** CSV —Ñ–∞–π–ª—ã —Å OHLCV –¥–∞–Ω–Ω—ã–º–∏ –æ—Ç MOEX API

### üîÑ –ü–†–û–¶–ï–°–°:
1. –ó–∞–≥—Ä—É–∑–∫–∞ CSV —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–∫–µ—Ä–∞
2. –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç –∏–∑ –∫–æ–ª–æ–Ω–æ–∫ `begin`, `end`, `trade_session_date`
3. –†–∞—Å—á—ë—Ç `log_return = log(close / close.shift(1))`
4. –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
5. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

### üì§ –í–´–•–û–î:
- **–§–∞–π–ª—ã:** `data/processed/{TICKER}_ohlcv_returns.parquet`
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
  ```python
  columns = ['date', 'open', 'high', 'low', 'close', 'volume', 'value', 
             'begin', 'end', 'log_return']
  ```
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:** 31 —Ñ–∞–π–ª (30 —Ç–∏–∫–µ—Ä–æ–≤ + IMOEX)

### ‚öôÔ∏è –§–£–ù–ö–¶–ò–ò:
- `load_ticker_data(ticker, timeframe='1D')` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ CSV
- `calculate_log_returns(prices)` ‚Äî —Ä–∞—Å—á—ë—Ç –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–µ–π

---

## `02_feature_engineering/` ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
02_feature_engineering/
‚îú‚îÄ‚îÄ 01_volatility_features.ipynb    # –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ 02_volume_features.ipynb         # –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ–±—ä—ë–º–æ–≤
‚îú‚îÄ‚îÄ 03_market_features.ipynb         # –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö —Ñ–∏—á–µ–π
‚îú‚îÄ‚îÄ 04_trend_features.ipynb          # –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤
‚îú‚îÄ‚îÄ 05_targets.ipynb                 # –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–µ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ 06_feature_aggregator.ipynb     # –§–∏–Ω–∞–ª—å–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è
‚îî‚îÄ‚îÄ data/features/                   # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    ‚îú‚îÄ‚îÄ {TICKER}_volatility_features.parquet
    ‚îú‚îÄ‚îÄ {TICKER}_volume_features.parquet
    ‚îú‚îÄ‚îÄ {TICKER}_market_features.parquet
    ‚îî‚îÄ‚îÄ {TICKER}_trend_features.parquet
```

### üì• –í–•–û–î:
- `data/processed/{TICKER}_ohlcv_returns.parquet` (–∏–∑ —ç—Ç–∞–ø–∞ 01)

### üîÑ –ü–†–û–¶–ï–°–°:
**01_volatility_features.ipynb:**
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (RV)
- EWMA –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
- Parkinson Volatility
- Garman-Klass Volatility
- **–í—ã—Ö–æ–¥:** `data/features/{TICKER}_volatility_features.parquet`

**02_volume_features.ipynb:**
- Volume Z-Score
- Volume Profile (POC, Value Area)
- Volume Spike detection
- **–í—ã—Ö–æ–¥:** `data/features/{TICKER}_volume_features.parquet`

**03_market_features.ipynb:**
- Beta –∫ IMOEX
- Correlation —Å –∏–Ω–¥–µ–∫—Å–æ–º
- Index Volatility
- **–í—ã—Ö–æ–¥:** `data/features/{TICKER}_market_features.parquet`

**04_trend_features.ipynb:**
- SMA/EMA —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
- Momentum
- RSI
- Trend signals
- **–í—ã—Ö–æ–¥:** `data/features/{TICKER}_trend_features.parquet`

**05_targets.ipynb:**
- –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–µ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
  - `target_vol_5d` ‚Äî 5-–¥–Ω–µ–≤–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
  - `target_vol_20d` ‚Äî 20-–¥–Ω–µ–≤–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

**06_feature_aggregator.ipynb:**
- **–ì–õ–ê–í–ù–´–ô –ê–ì–†–ï–ì–ê–¢–û–†** ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ —Ñ–∏—á–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `features/feature_builder.py` (production –º–æ–¥—É–ª—å)
- –†–∞–∑–¥–µ–ª—è–µ—Ç –Ω–∞ ML –∏ Backtest –¥–∞–Ω–Ω—ã–µ

### üì§ –í–´–•–û–î:
- **ML –¥–∞–Ω–Ω—ã–µ:** `data/processed_ml/{TICKER}_ml_features.parquet`
  - –¢–æ–ª—å–∫–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–±–µ–∑ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö —Ü–µ–Ω)
  - ~51 –ø—Ä–∏–∑–Ω–∞–∫ –Ω–∞ —Ç–∏–∫–µ—Ä
- **Backtest –¥–∞–Ω–Ω—ã–µ:** `data/backtest/{TICKER}_price_data.parquet`
  - –°—ã—Ä—ã–µ OHLCV –¥–ª—è –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞

---

## `03_models/` ‚Äî –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
03_models/
‚îú‚îÄ‚îÄ 01_baseline_models.ipynb         # Baseline (NAIVE, EWMA)
‚îú‚îÄ‚îÄ 02_garch_model.ipynb             # GARCH(1,1) Skewed-t
‚îú‚îÄ‚îÄ 03_lightgbm_quantile.ipynb        # LightGBM (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π, –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–∏–∫–µ—Ä–∞)
‚îú‚îÄ‚îÄ 04_ensemble_model.ipynb           # Ensemble (notebook)
‚îú‚îÄ‚îÄ train_global_model.py             # ‚≠ê PRODUCTION: –ì–ª–æ–±–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å
‚îú‚îÄ‚îÄ inference.py                      # ‚≠ê PRODUCTION: –ò–Ω—Ñ–µ—Ä–µ–Ω—Å
‚îî‚îÄ‚îÄ data/models/                      # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    ‚îú‚îÄ‚îÄ {TICKER}_baseline_forecasts.parquet
    ‚îú‚îÄ‚îÄ {TICKER}_garch_forecasts.parquet
    ‚îî‚îÄ‚îÄ {TICKER}_lgb_quantile_forecasts.parquet
```

### üì• –í–•–û–î:
- `data/processed_ml/{TICKER}_ml_features.parquet` (–¥–ª—è LightGBM)
- `data/processed/{TICKER}_ohlcv_returns.parquet` (–¥–ª—è GARCH)

### üîÑ –ü–†–û–¶–ï–°–°:

**01_baseline_models.ipynb:**
- NAIVE: `forecast = last_value`
- EWMA: —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ
- **–í—ã—Ö–æ–¥:** `data/models/{TICKER}_baseline_forecasts.parquet`

**02_garch_model.ipynb:**
- GARCH(1,1) —Å Skewed-t —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
- Walk-forward –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–í—ã—Ö–æ–¥:** `data/models/{TICKER}_garch_forecasts.parquet`

**03_lightgbm_quantile.ipynb:**
- ‚ö†Ô∏è **–£–°–¢–ê–†–ï–í–®–ò–ô** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –æ–¥–Ω–∏–º —Ç–∏–∫–µ—Ä–æ–º
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `train_global_model.py` –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ!

**04_ensemble_model.ipynb:**
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ GARCH + LightGBM
- –í–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Å—Ä–µ–¥–Ω–µ–µ
- ‚ö†Ô∏è **–¢–æ–ª—å–∫–æ notebook, –Ω–µ—Ç production –º–æ–¥—É–ª—è**

**train_global_model.py** ‚≠ê **PRODUCTION:**
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –í–°–ï —Ç–∏–∫–µ—Ä—ã –∏–∑ `data/processed_ml/`
- –í—Ä–µ–º–µ–Ω–Ω–æ–π split (train: –¥–æ 2024-01-01, test: –ø–æ—Å–ª–µ)
- –û–±—É—á–µ–Ω–∏–µ 3 –∫–≤–∞–Ω—Ç–∏–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π (q16, q50, q84)
- Sample weighting –ø–æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
- **–í—ã—Ö–æ–¥:**
  - `data/models/global_lgbm_q16.txt`
  - `data/models/global_lgbm_q50.txt`
  - `data/models/global_lgbm_q84.txt`
  - `reports/feature_importance.csv`
  - `reports/validation_report.csv`

**inference.py** ‚≠ê **PRODUCTION:**
- –ö–ª–∞—Å—Å `GlobalQuantileModel`
- –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
  ```python
  from inference import GlobalQuantileModel
  model = GlobalQuantileModel()
  model.load_models()
  predictions = model.predict(new_data)
  ```

### üì§ –í–´–•–û–î:
- –û–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏: `data/models/global_lgbm_q*.txt`
- –ü—Ä–æ–≥–Ω–æ–∑—ã: `data/models/{TICKER}_*_forecasts.parquet`
- –û—Ç—á—ë—Ç—ã: `reports/feature_importance.csv`, `validation_report.csv`

---

## `04_backtesting/` ‚Äî –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
04_backtesting/
‚îú‚îÄ‚îÄ 01_signals_and_channels.ipynb    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
‚îú‚îÄ‚îÄ 02_backtest_engine.ipynb          # –î–≤–∏–∂–æ–∫ –±—ç–∫—Ç–µ—Å—Ç–∞
‚îú‚îÄ‚îÄ 03_analysis_results.ipynb         # –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îî‚îÄ‚îÄ run_backtest_pipeline.py           # ‚≠ê PRODUCTION: –ü–æ–ª–Ω—ã–π pipeline
```

### üì• –í–•–û–î:
- `data/processed_ml/{TICKER}_ml_features.parquet` (–¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤)
- `data/backtest/{TICKER}_price_data.parquet` (–¥–ª—è —Ü–µ–Ω)
- `data/models/global_lgbm_q*.txt` (–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏)

### üîÑ –ü–†–û–¶–ï–°–°:

**01_signals_and_channels.ipynb:**
- –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–≤–∞–Ω—Ç–∏–ª–µ–π –≤ —Ü–µ–Ω–æ–≤—ã–µ —É—Ä–æ–≤–Ω–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ ¬±1œÉ, ¬±2œÉ
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

**02_backtest_engine.ipynb:**
- –°–∏–º—É–ª—è—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏
- –†–∞—Å—á—ë—Ç PL, –∫–æ–º–∏—Å—Å–∏–π, slippage
- –ú–µ—Ç—Ä–∏–∫–∏: Sharpe, Win Rate, Expectancy

**03_analysis_results.ipynb:**
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è equity curve
- –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–π–¥–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º

**run_backtest_pipeline.py** ‚≠ê **PRODUCTION:**
- –ü–æ–ª–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π pipeline
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ `inference.py`
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è –≤—Å–µ—Ö —Ç–∏–∫–µ—Ä–æ–≤
- –°—Ç—Ä–æ–≥–∏–π –±—ç–∫—Ç–µ—Å—Ç (–±–µ–∑ look-ahead bias)
- **–í—ã—Ö–æ–¥:** `data/backtest/{TICKER}_backtest_results.parquet`

### üì§ –í–´–•–û–î:
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ç–∫—Ç–µ—Å—Ç–∞: `data/backtest/{TICKER}_backtest_results.parquet`
- –ú–µ—Ç—Ä–∏–∫–∏: CSV —Ñ–∞–π–ª—ã —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

---

## `05_explainability/` ‚Äî –û–±—ä—è—Å–Ω–∏–º–æ—Å—Ç—å –º–æ–¥–µ–ª–µ–π

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
05_explainability/
‚îú‚îÄ‚îÄ 01_shap_explainer.ipynb          # SHAP values –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è
‚îî‚îÄ‚îÄ 02_feature_importance.ipynb      # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –≤–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
```

### üì• –í–•–û–î:
- –û–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏: `data/models/global_lgbm_q*.txt`
- –î–∞–Ω–Ω—ã–µ: `data/processed_ml/{TICKER}_ml_features.parquet`

### üîÑ –ü–†–û–¶–ï–°–°:
- SHAP values –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
- Feature importance –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

### üì§ –í–´–•–û–î:
- SHAP plots (PNG)
- Feature importance charts

---

## `06_utils/` ‚Äî –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
06_utils/
‚îú‚îÄ‚îÄ 01_helpers.ipynb                 # –§—É–Ω–∫—Ü–∏–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ 02_validation_testing.ipynb      # Unit-—Ç–µ—Å—Ç—ã
```

### üì• –í–•–û–î:
- –†–∞–∑–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### üîÑ –ü–†–û–¶–ï–°–°:
- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- Unit-—Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

---

# üì¶ –ü–ê–ü–ö–ò –ë–ï–ó –ò–ù–î–ï–ö–°–û–í (Production –ú–æ–¥—É–ª–∏)

## `features/` ‚Äî Production –º–æ–¥—É–ª–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

### üéØ –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï:
**Production-ready –º–æ–¥—É–ª–∏** –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `feature_builder.py` –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ –ª—é–±–æ–º –∫–æ–¥–µ.

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
features/
‚îú‚îÄ‚îÄ __init__.py                       # –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
‚îú‚îÄ‚îÄ feature_builder.py                # ‚≠ê –ì–õ–ê–í–ù–´–ô –û–†–ö–ï–°–¢–†–ê–¢–û–†
‚îú‚îÄ‚îÄ volume_features.py                # –û–±—ä—ë–º–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
‚îú‚îÄ‚îÄ trend_features.py                 # –¢—Ä–µ–Ω–¥–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
‚îú‚îÄ‚îÄ calendar_features.py              # –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
‚îú‚îÄ‚îÄ volatility_features.py            # –ü—Ä–∏–∑–Ω–∞–∫–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ market_features.py                # –†—ã–Ω–æ—á–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (Beta, Correlation)
‚îî‚îÄ‚îÄ Loaders/
    ‚îú‚îÄ‚îÄ load_prices.py                # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ MOEX API
    ‚îî‚îÄ‚îÄ price_cleaner.py              # –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
```

### üì• –í–•–û–î:
- DataFrame —Å OHLCV –∏ `log_return`
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: DataFrame –∏–Ω–¥–µ–∫—Å–∞ IMOEX (–¥–ª—è market features)

### üîÑ –ü–†–û–¶–ï–°–°:

**feature_builder.py** ‚Äî –ì–õ–ê–í–ù–´–ô –ú–û–î–£–õ–¨:
```python
from features import build_all_features

ml_features, backtest_data = build_all_features(df, ticker, index_df=index_df)
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –í—ã–∑—ã–≤–∞–µ—Ç –≤—Å–µ –º–æ–¥—É–ª–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
2. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
3. –î–æ–±–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ä–∞
4. –†–∞–∑–¥–µ–ª—è–µ—Ç –Ω–∞ ML –∏ Backtest –≤—ã—Ö–æ–¥—ã
5. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫

**volume_features.py:**
- `build_volume_features(df)` ‚Üí DataFrame —Å –æ–±—ä—ë–º–Ω—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏
- –ü—Ä–∏–∑–Ω–∞–∫–∏: `volume_zscore_20`, `volume_zscore_60`, `volume_spike`, `vp_position`, `vp_width_pct`, `vp_above_va`

**trend_features.py:**
- `build_trend_features(df)` ‚Üí DataFrame —Å —Ç—Ä–µ–Ω–¥–æ–≤—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏
- –ü—Ä–∏–∑–Ω–∞–∫–∏: `dist_to_sma_20`, `dist_to_ema_50`, `rsi_14`, `momentum_10`, `trend_signal`, –∏ —Ç.–¥.

**calendar_features.py:**
- `build_calendar_features(df)` ‚Üí DataFrame —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏
- –ü—Ä–∏–∑–Ω–∞–∫–∏: `day_of_week`, `day_of_month`, `overnight_gap`, –∏ —Ç.–¥.

**volatility_features.py:**
- `build_volatility_features(df)` ‚Üí DataFrame —Å –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- –ü—Ä–∏–∑–Ω–∞–∫–∏: `rv_5d`, `rv_20d`, `ewma_vol_10d`, `parkinson_vol_20d`, `gk_vol_20d`, –∏ —Ç.–¥.

**market_features.py:**
- `build_market_features(df, index_df)` ‚Üí DataFrame —Å —Ä—ã–Ω–æ—á–Ω—ã–º–∏ –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏
- –ü—Ä–∏–∑–Ω–∞–∫–∏: `beta_30d`, `beta_60d`, `correlation_30d`, `correlation_60d`, `index_vol_30d`, –∏ —Ç.–¥.

### üì§ –í–´–•–û–î:
- **ML –ø—Ä–∏–∑–Ω–∞–∫–∏:** DataFrame —Å ~51 –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–∏–∑–Ω–∞–∫–æ–º
- **Backtest –¥–∞–Ω–Ω—ã–µ:** DataFrame —Å —Å—ã—Ä—ã–º–∏ OHLCV

### üîó –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
```python
# –í production –∫–æ–¥–µ
from features import build_all_features, process_all_tickers

# –î–ª—è –æ–¥–Ω–æ–≥–æ —Ç–∏–∫–µ—Ä–∞
ml_features, backtest = build_all_features(df, 'SBER', index_df=imoex_df)

# –î–ª—è –≤—Å–µ—Ö —Ç–∏–∫–µ—Ä–æ–≤
process_all_tickers(data_dir, output_ml_dir, output_backtest_dir)
```

---

## `utils/` ‚Äî –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã

### üéØ –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï:
**–ü—É—Å—Ç–∞—è –ø–∞–ø–∫–∞-–∑–∞–≥–ª—É—à–∫–∞** –¥–ª—è –±—É–¥—É—â–∏—Ö production —É—Ç–∏–ª–∏—Ç.

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
utils/
‚îî‚îÄ‚îÄ __init__.py                       # –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª
```

### üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–ï:
- –°–µ–π—á–∞—Å –ø—É—Å—Ç–∞—è, –Ω–æ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
  - –§—É–Ω–∫—Ü–∏–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
  - –í–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
  - –û–±—â–∏–µ —Ö–µ–ª–ø–µ—Ä—ã

---

## `explainability/` ‚Äî –û–±—ä—è—Å–Ω–∏–º–æ—Å—Ç—å –º–æ–¥–µ–ª–µ–π

### üéØ –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï:
**–ü—É—Å—Ç–∞—è –ø–∞–ø–∫–∞-–∑–∞–≥–ª—É—à–∫–∞** –¥–ª—è production –º–æ–¥—É–ª–µ–π –æ–±—ä—è—Å–Ω–∏–º–æ—Å—Ç–∏.

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
explainability/
‚îî‚îÄ‚îÄ __init__.py                       # –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª
```

### üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–ï:
- –°–µ–π—á–∞—Å –ø—É—Å—Ç–∞—è, –Ω–æ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
  - `shap_explainer.py` ‚Äî production –º–æ–¥—É–ª—å –¥–ª—è SHAP
  - `feature_importance.py` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –≤–∞–∂–Ω–æ—Å—Ç–∏

### üîó –°–í–Ø–ó–¨:
- Notebooks –≤ `05_explainability/` ‚Äî –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –≤–µ—Ä—Å–∏–∏
- –ú–æ–¥—É–ª–∏ –∑–¥–µ—Å—å ‚Äî production –≤–µ—Ä—Å–∏–∏ (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)

---

## `backtest/` ‚Äî –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ –º–æ–¥—É–ª–∏

### üéØ –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï:
**–ü—É—Å—Ç–∞—è –ø–∞–ø–∫–∞-–∑–∞–≥–ª—É—à–∫–∞** –¥–ª—è production –º–æ–¥—É–ª–µ–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞.

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
backtest/
‚îî‚îÄ‚îÄ __init__.py                       # –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª
```

### üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–ï:
- –°–µ–π—á–∞—Å –ø—É—Å—Ç–∞—è, –Ω–æ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
  - `backtest_engine.py` ‚Äî –¥–≤–∏–∂–æ–∫ –±—ç–∫—Ç–µ—Å—Ç–∞
  - `signal_generator.py` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤

### üîó –°–í–Ø–ó–¨:
- `04_backtesting/run_backtest_pipeline.py` ‚Äî production —Å–∫—Ä–∏–ø—Ç (–≤ –ø–∞–ø–∫–µ —Å –∏–Ω–¥–µ–∫—Å–æ–º)
- –ú–æ–¥—É–ª–∏ –∑–¥–µ—Å—å ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)

---

## `models/` ‚Äî –ú–æ–¥–µ–ª–∏

### üéØ –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï:
**–ü—É—Å—Ç–∞—è –ø–∞–ø–∫–∞-–∑–∞–≥–ª—É—à–∫–∞** –¥–ª—è production –º–æ–¥—É–ª–µ–π –º–æ–¥–µ–ª–µ–π.

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
models/
‚îî‚îÄ‚îÄ __init__.py                       # –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª
```

### üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–ï:
- –°–µ–π—á–∞—Å –ø—É—Å—Ç–∞—è, –Ω–æ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
  - `ensemble.py` ‚Äî –º–æ–¥—É–ª—å –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
  - `garch_wrapper.py` ‚Äî –æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è GARCH

### üîó –°–í–Ø–ó–¨:
- `03_models/train_global_model.py` ‚Äî production —Å–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è
- `03_models/inference.py` ‚Äî production –º–æ–¥—É–ª—å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
- –ú–æ–¥—É–ª–∏ –∑–¥–µ—Å—å ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)

---

## `config/` ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### üéØ –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï:
**Production –º–æ–¥—É–ª—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ —Ç–∏–∫–µ—Ä–æ–≤ –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏.

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
config/
‚îú‚îÄ‚îÄ __init__.py                       # –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
‚îî‚îÄ‚îÄ tickers_metadata.json            # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–∏–∫–µ—Ä–æ–≤
```

### üì• –í–•–û–î:
- `tickers_metadata.json` ‚Äî JSON —Ñ–∞–π–ª —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

### üîÑ –ü–†–û–¶–ï–°–°:

**__init__.py:**
- `load_tickers_metadata()` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ JSON
- `get_ticker_metadata(ticker)` ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ —Ç–∏–∫–µ—Ä–∞
- `get_tickers_by_sector(sector)` ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ç–æ—Ä—É
- `get_blue_chips()` ‚Äî —Å–ø–∏—Å–æ–∫ –≥–æ–ª—É–±—ã—Ö —Ñ–∏—à–µ–∫
- `get_tickers_by_liquidity(top_n)` ‚Äî —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
- `encode_metadata_features(ticker)` ‚Äî –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è ML

**tickers_metadata.json:**
```json
{
  "SBER": {
    "sector": "Finance",
    "liquidity_rank": 1,
    "is_blue_chip": 1,
    "lot_size": 10,
    "name": "–°–±–µ—Ä–±–∞–Ω–∫"
  },
  ...
}
```

### üì§ –í–´–•–û–î:
- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- –ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏: `sector_encoded`, `liquidity_rank`, `is_blue_chip`, `lot_size_log`

### üîó –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
```python
from config import get_ticker_metadata, encode_metadata_features

meta = get_ticker_metadata('SBER')
features = encode_metadata_features('SBER')
```

---

# üìä –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–•

## `data/` ‚Äî –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
data/
‚îú‚îÄ‚îÄ MOEX_DATA/                        # –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ MOEX
‚îÇ   ‚îú‚îÄ‚îÄ {TICKER}/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1D/                      # –î–Ω–µ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ *.csv                # OHLCV –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ *.png                # –ì—Ä–∞—Ñ–∏–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 1H/                      # –ß–∞—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ *.csv
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ *.png
‚îÇ   ‚îî‚îÄ‚îÄ Dividends.txt                # –î–∏–≤–∏–¥–µ–Ω–¥—ã
‚îÇ
‚îú‚îÄ‚îÄ processed/                        # ‚≠ê –≠–¢–ê–ü 1: –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îî‚îÄ‚îÄ {TICKER}_ohlcv_returns.parquet
‚îÇ
‚îú‚îÄ‚îÄ processed_ml/                     # ‚≠ê –≠–¢–ê–ü 2: ML –ø—Ä–∏–∑–Ω–∞–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ {TICKER}_ml_features.parquet
‚îÇ
‚îú‚îÄ‚îÄ backtest/                        # ‚≠ê –≠–¢–ê–ü 3: Backtest –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îî‚îÄ‚îÄ {TICKER}_price_data.parquet
‚îÇ
‚îî‚îÄ‚îÄ models/                          # ‚≠ê –≠–¢–ê–ü 4: –ú–æ–¥–µ–ª–∏ –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã
    ‚îú‚îÄ‚îÄ global_lgbm_q16.txt          # –û–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
    ‚îú‚îÄ‚îÄ global_lgbm_q50.txt
    ‚îú‚îÄ‚îÄ global_lgbm_q84.txt
    ‚îú‚îÄ‚îÄ {TICKER}_baseline_forecasts.parquet
    ‚îú‚îÄ‚îÄ {TICKER}_garch_forecasts.parquet
    ‚îî‚îÄ‚îÄ feature_importance.csv
```

### üìã –û–ü–ò–°–ê–ù–ò–ï –ü–ê–ü–û–ö:

**`MOEX_DATA/`** ‚Äî –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- CSV —Ñ–∞–π–ª—ã —Å OHLCV –æ—Ç MOEX API
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `{TICKER}/{TIMEFRAME}/*.csv`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `01_data_loading.ipynb`

**`processed/`** ‚Äî –≠—Ç–∞–ø 1:
- –í—Ö–æ–¥ –¥–ª—è `02_feature_engineering/`
- –°–æ–¥–µ—Ä–∂–∏—Ç: `date`, `open`, `high`, `low`, `close`, `volume`, `log_return`
- –§–æ—Ä–º–∞—Ç: Parquet (31 —Ñ–∞–π–ª)

**`processed_ml/`** ‚Äî –≠—Ç–∞–ø 2:
- –í—Ö–æ–¥ –¥–ª—è `03_models/train_global_model.py`
- –°–æ–¥–µ—Ä–∂–∏—Ç: ~51 –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫ + `target_vol_5d`
- –§–æ—Ä–º–∞—Ç: Parquet (31 —Ñ–∞–π–ª)
- **–ö–†–ò–¢–ò–ß–ù–û:** –ë–µ–∑ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö —Ü–µ–Ω!

**`backtest/`** ‚Äî –≠—Ç–∞–ø 3:
- –í—Ö–æ–¥ –¥–ª—è `04_backtesting/run_backtest_pipeline.py`
- –°–æ–¥–µ—Ä–∂–∏—Ç: —Å—ã—Ä—ã–µ OHLCV –¥–ª—è –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞
- –§–æ—Ä–º–∞—Ç: Parquet (31 —Ñ–∞–π–ª)

**`models/`** ‚Äî –≠—Ç–∞–ø 4:
- –û–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏: `global_lgbm_q*.txt`
- –ü—Ä–æ–≥–Ω–æ–∑—ã –º–æ–¥–µ–ª–µ–π: `{TICKER}_*_forecasts.parquet`
- –ú–µ—Ç—Ä–∏–∫–∏: `*_metrics.csv`

---

# üöÄ –ü–û–®–ê–ì–û–í–´–ô –ì–ê–ô–î: –û–ë–£–ß–ï–ù–ò–ï –ú–û–î–ï–õ–ò –° –ù–£–õ–Ø

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. ‚úÖ Python 3.8+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
2. ‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ (`venv/`)
3. ‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`requirements.txt`)
4. ‚úÖ –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ `data/MOEX_DATA/`

---

## –≠–¢–ê–ü 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### üìç –§–∞–π–ª: `01_data_loading.ipynb`

### üéØ –¶–µ–ª—å:
–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å CSV —Ñ–∞–π–ª—ã –∏–∑ `MOEX_DATA/` –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å `log_return`.

### üì• –í–•–û–î:
- `data/MOEX_DATA/{TICKER}/1D/*.csv` (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–∫–µ—Ä–∞)

### üîß –î–ï–ô–°–¢–í–ò–Ø:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ notebook:**
   ```bash
   cd ML
   .\start_jupyter.ps1
   # –û—Ç–∫—Ä–æ–π—Ç–µ 01_data_loading.ipynb
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —è—á–µ–π–∫–∏:**
   - –ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π
   - –§—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
   - –¶–∏–∫–ª –ø–æ —Ç–∏–∫–µ—Ä–∞–º

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   ```python
   # –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Ñ–∞–π–ª—ã:
   data/processed/SBER_ohlcv_returns.parquet
   data/processed/GAZP_ohlcv_returns.parquet
   # ... –∏ —Ç.–¥. (31 —Ñ–∞–π–ª)
   ```

### üì§ –í–´–•–û–î:
- ‚úÖ **31 —Ñ–∞–π–ª** –≤ `data/processed/{TICKER}_ohlcv_returns.parquet`
- ‚úÖ –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç: `date`, `open`, `high`, `low`, `close`, `volume`, `log_return`

### ‚ö†Ô∏è –í–ê–ñ–ù–û:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **IMOEX** —Ç–æ–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–Ω—É–∂–µ–Ω –¥–ª—è market features)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `log_return` —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–Ω–µ –≤—Å–µ NaN)

---

## –≠–¢–ê–ü 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (Feature Engineering)

### üìç –§–∞–π–ª: `features/feature_builder.py` (PRODUCTION) –∏–ª–∏ `02_feature_engineering/06_feature_aggregator.ipynb`

### üéØ –¶–µ–ª—å:
–°–æ–∑–¥–∞—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è ML –º–æ–¥–µ–ª–∏ –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ ML/Backtest –¥–∞–Ω–Ω—ã–µ.

### üì• –í–•–û–î:
- `data/processed/{TICKER}_ohlcv_returns.parquet` (31 —Ñ–∞–π–ª)
- `config/tickers_metadata.json` (–¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)
- `data/processed/IMOEX_ohlcv_returns.parquet` (–¥–ª—è market features)

### üîß –î–ï–ô–°–¢–í–ò–Ø:

**–í–∞—Ä–∏–∞–Ω—Ç A: Production —Å–∫—Ä–∏–ø—Ç (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

```bash
cd ML
.\venv\Scripts\python.exe features\feature_builder.py
```

**–í–∞—Ä–∏–∞–Ω—Ç B: Notebook**

1. –û—Ç–∫—Ä–æ–π—Ç–µ `02_feature_engineering/06_feature_aggregator.ipynb`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —è—á–µ–π–∫–∏

### üîÑ –ü–†–û–¶–ï–°–°:

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏:**

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –ß–∏—Ç–∞–µ—Ç `data/processed/{TICKER}_ohlcv_returns.parquet`
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–Ω–¥–µ–∫—Å IMOEX –¥–ª—è market features

2. **–†–∞—Å—á—ë—Ç –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (—á–µ—Ä–µ–∑ –º–æ–¥—É–ª–∏):**
   - `build_volume_features()` ‚Üí –æ–±—ä—ë–º–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
   - `build_trend_features()` ‚Üí —Ç—Ä–µ–Ω–¥–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
   - `build_calendar_features()` ‚Üí –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
   - `build_volatility_features()` ‚Üí –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
   - `build_market_features()` ‚Üí Beta, Correlation

3. **–°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π:**
   - `target_vol_5d` = —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞ 5 –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥

4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ ML/Backtest:**
   - **ML:** —Ç–æ–ª—å–∫–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–±–µ–∑ —Ü–µ–Ω)
   - **Backtest:** —Å—ã—Ä—ã–µ OHLCV

5. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ NaN –∏ infinity

### üì§ –í–´–•–û–î:
- ‚úÖ **31 —Ñ–∞–π–ª** –≤ `data/processed_ml/{TICKER}_ml_features.parquet`
  - –°–æ–¥–µ—Ä–∂–∏—Ç: ~51 –ø—Ä–∏–∑–Ω–∞–∫ + `target_vol_5d`
  - **–ë–ï–ó** –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö —Ü–µ–Ω!
- ‚úÖ **31 —Ñ–∞–π–ª** –≤ `data/backtest/{TICKER}_price_data.parquet`
  - –°–æ–¥–µ—Ä–∂–∏—Ç: `date`, `open`, `high`, `low`, `close`, `volume`

### ‚ö†Ô∏è –í–ê–ñ–ù–û:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `liquidity_rank` –¥–æ–±–∞–≤–ª–µ–Ω (–∏–∑ `tickers_metadata.json`)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ market features —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã (Beta, Correlation)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~51

---

## –≠–¢–ê–ü 3: –û–±—É—á–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏

### üìç –§–∞–π–ª: `03_models/train_global_model.py`

### üéØ –¶–µ–ª—å:
–û–±—É—á–∏—Ç—å –∫–≤–∞–Ω—Ç–∏–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ LightGBM –Ω–∞ –≤—Å–µ—Ö —Ç–∏–∫–µ—Ä–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

### üì• –í–•–û–î:
- `data/processed_ml/{TICKER}_ml_features.parquet` (31 —Ñ–∞–π–ª)
- `config/tickers_metadata.json` (–¥–ª—è sample weights)

### üîß –î–ï–ô–°–¢–í–ò–Ø:

```bash
cd ML
.\venv\Scripts\python.exe 03_models\train_global_model.py
```

### üîÑ –ü–†–û–¶–ï–°–°:

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –ß–∏—Ç–∞–µ—Ç –≤—Å–µ `*_ml_features.parquet` —Ñ–∞–π–ª—ã
   - –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤ –æ–¥–∏–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π DataFrame
   - –î–æ–±–∞–≤–ª—è–µ—Ç `liquidity_rank` –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

2. **–°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π:**
   - `target_vol_5d` = rolling_std(log_return, 5).shift(-5) * sqrt(252)

3. **–í—Ä–µ–º–µ–Ω–Ω–æ–π split:**
   - Train: –¥–æ 2024-01-01
   - Test: –ø–æ—Å–ª–µ 2024-01-01
   - **–ö–†–ò–¢–ò–ß–ù–û:** –ë–µ–∑ shuffle! (time-series split)

4. **Sample weighting:**
   - –í–µ—Å–∞ –ø–æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏: `weight = 1 / log(liquidity_rank + 2)`
   - –ë–æ–ª–µ–µ –ª–∏–∫–≤–∏–¥–Ω—ã–µ –∞–∫—Ü–∏–∏ –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª—å—à–∏–π –≤–µ—Å

5. **–û–±—É—á–µ–Ω–∏–µ 3 –º–æ–¥–µ–ª–µ–π:**
   - q16 (–Ω–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞)
   - q50 (–º–µ–¥–∏–∞–Ω–∞)
   - q84 (–≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞)
   - Early stopping –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

6. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:**
   - –ú–æ–¥–µ–ª–∏: `data/models/global_lgbm_q*.txt`
   - –û—Ç—á—ë—Ç—ã: `reports/feature_importance.csv`, `validation_report.csv`

### üì§ –í–´–•–û–î:
- ‚úÖ **3 —Ñ–∞–π–ª–∞ –º–æ–¥–µ–ª–µ–π:**
  - `data/models/global_lgbm_q16.txt`
  - `data/models/global_lgbm_q50.txt`
  - `data/models/global_lgbm_q84.txt`
- ‚úÖ **–û—Ç—á—ë—Ç—ã:**
  - `reports/feature_importance.csv`
  - `reports/feature_importance.png`
  - `reports/validation_report.csv`

### ‚ö†Ô∏è –í–ê–ñ–ù–û:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:
  - –ü–æ–∫—Ä—ã—Ç–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ [q16, q84] –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~68%
  - Quantile Loss –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑—É–º–Ω—ã–º
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `ticker_id` –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–∏–∑–Ω–∞–∫ (–∏–ª–∏ –∏—Å–∫–ª—é—á—ë–Ω)

---

## –≠–¢–ê–ü 4: –û–±—É—á–µ–Ω–∏–µ GARCH –º–æ–¥–µ–ª–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### üìç –§–∞–π–ª: `03_models/02_garch_model.ipynb`

### üéØ –¶–µ–ª—å:
–û–±—É—á–∏—Ç—å GARCH(1,1) –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–∫–µ—Ä–∞ –æ—Ç–¥–µ–ª—å–Ω–æ.

### üì• –í–•–û–î:
- `data/processed/{TICKER}_ohlcv_returns.parquet` (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–∫–µ—Ä–∞)

### üîß –î–ï–ô–°–¢–í–ò–Ø:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `03_models/02_garch_model.ipynb`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —è—á–µ–π–∫–∏ (–æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ —Ç–∏–∫–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### üì§ –í–´–•–û–î:
- ‚úÖ **31 —Ñ–∞–π–ª** –≤ `data/models/{TICKER}_garch_forecasts.parquet`

### ‚ö†Ô∏è –í–ê–ñ–ù–û:
- GARCH –æ–±—É—á–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–∫–µ—Ä–∞
- –ú–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (31 –º–æ–¥–µ–ª—å)
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–∏–∫–µ—Ä—ã –º–æ–≥—É—Ç –Ω–µ —Å–æ–π—Ç–∏—Å—å (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏)

---

## –≠–¢–ê–ü 5: –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### üìç –§–∞–π–ª: `04_backtesting/run_backtest_pipeline.py`

### üéØ –¶–µ–ª—å:
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—Ä–≥–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

### üì• –í–•–û–î:
- `data/processed_ml/{TICKER}_ml_features.parquet` (–¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤)
- `data/backtest/{TICKER}_price_data.parquet` (–¥–ª—è —Ü–µ–Ω)
- `data/models/global_lgbm_q*.txt` (–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏)

### üîß –î–ï–ô–°–¢–í–ò–Ø:

```bash
cd ML
.\venv\Scripts\python.exe 04_backtesting\run_backtest_pipeline.py
```

### üì§ –í–´–•–û–î:
- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ç–∫—Ç–µ—Å—Ç–∞: `data/backtest/{TICKER}_backtest_results.parquet`
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

# üìã –ß–ï–ö–õ–ò–°–¢: –ß–¢–û –ù–£–ñ–ù–û –î–õ–Ø –ö–ê–ñ–î–û–ì–û –≠–¢–ê–ü–ê

## ‚úÖ –≠–¢–ê–ü 1: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**–ù—É–∂–Ω–æ:**
- [ ] CSV —Ñ–∞–π–ª—ã –≤ `data/MOEX_DATA/{TICKER}/1D/*.csv`
- [ ] Jupyter –∑–∞–ø—É—â–µ–Ω
- [ ] `01_data_loading.ipynb` –æ—Ç–∫—Ä—ã—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- [ ] 31 —Ñ–∞–π–ª –≤ `data/processed/{TICKER}_ohlcv_returns.parquet`

---

## ‚úÖ –≠–¢–ê–ü 2: Feature Engineering

**–ù—É–∂–Ω–æ:**
- [ ] 31 —Ñ–∞–π–ª –∏–∑ —ç—Ç–∞–ø–∞ 1
- [ ] `config/tickers_metadata.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] `data/processed/IMOEX_ohlcv_returns.parquet` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- [ ] 31 —Ñ–∞–π–ª –≤ `data/processed_ml/{TICKER}_ml_features.parquet`
- [ ] 31 —Ñ–∞–π–ª –≤ `data/backtest/{TICKER}_price_data.parquet`
- [ ] –ö–∞–∂–¥—ã–π ML —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç ~51 –ø—Ä–∏–∑–Ω–∞–∫

---

## ‚úÖ –≠–¢–ê–ü 3: –û–±—É—á–µ–Ω–∏–µ LightGBM

**–ù—É–∂–Ω–æ:**
- [ ] 31 —Ñ–∞–π–ª –∏–∑ —ç—Ç–∞–ø–∞ 2 (`processed_ml/`)
- [ ] `config/tickers_metadata.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] Python —Å–∫—Ä–∏–ø—Ç `train_global_model.py`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- [ ] 3 —Ñ–∞–π–ª–∞ –º–æ–¥–µ–ª–µ–π: `global_lgbm_q16.txt`, `global_lgbm_q50.txt`, `global_lgbm_q84.txt`
- [ ] –û—Ç—á—ë—Ç—ã –≤ `reports/`

---

## ‚úÖ –≠–¢–ê–ü 4: –û–±—É—á–µ–Ω–∏–µ GARCH (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ù—É–∂–Ω–æ:**
- [ ] 31 —Ñ–∞–π–ª –∏–∑ —ç—Ç–∞–ø–∞ 1 (`processed/`)
- [ ] –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ `arch` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- [ ] Notebook `02_garch_model.ipynb`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- [ ] 31 —Ñ–∞–π–ª –≤ `data/models/{TICKER}_garch_forecasts.parquet`

---

## ‚úÖ –≠–¢–ê–ü 5: –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ù—É–∂–Ω–æ:**
- [ ] –ú–æ–¥–µ–ª–∏ –∏–∑ —ç—Ç–∞–ø–∞ 3
- [ ] ML features –∏–∑ —ç—Ç–∞–ø–∞ 2
- [ ] Price data –∏–∑ —ç—Ç–∞–ø–∞ 2

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ç–∫—Ç–µ—Å—Ç–∞

---

# üîÑ –ü–û–õ–ù–´–ô PIPELINE (–û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞)

–ï—Å–ª–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π pipeline:

```bash
cd ML

# 1. Feature Engineering
.\venv\Scripts\python.exe features\feature_builder.py

# 2. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
.\venv\Scripts\python.exe 03_models\train_global_model.py

# 3. –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
.\venv\Scripts\python.exe 04_backtesting\run_backtest_pipeline.py
```

---

# üìä –°–•–ï–ú–ê –ü–û–¢–û–ö–ê –î–ê–ù–ù–´–•

```
MOEX_DATA/*.csv
    ‚Üì
[01_data_loading.ipynb]
    ‚Üì
processed/{TICKER}_ohlcv_returns.parquet
    ‚Üì
[features/feature_builder.py]
    ‚Üì
processed_ml/{TICKER}_ml_features.parquet  ‚îÄ‚îÄ‚îê
    ‚Üì                                         ‚îÇ
[train_global_model.py]                      ‚îÇ
    ‚Üì                                         ‚îÇ
models/global_lgbm_q*.txt                    ‚îÇ
    ‚Üì                                         ‚îÇ
[inference.py]                                ‚îÇ
    ‚Üì                                         ‚îÇ
–ü—Ä–æ–≥–Ω–æ–∑—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚Üí [run_backtest_pipeline.py]
    ‚Üì                                         ‚îÇ         ‚Üì
backtest/{TICKER}_price_data.parquet ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
```

---

# üéØ –ö–õ–Æ–ß–ï–í–´–ï –ú–û–ú–ï–ù–¢–´

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ ML/Backtest:**
   - ML –¥–∞–Ω–Ω—ã–µ: —Ç–æ–ª—å–∫–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
   - Backtest –¥–∞–Ω–Ω—ã–µ: —Å—ã—Ä—ã–µ OHLCV

2. **–í—Ä–µ–º–µ–Ω–Ω–æ–π split:**
   - Train: –¥–æ 2024-01-01
   - Test: –ø–æ—Å–ª–µ 2024-01-01
   - –ë–µ–∑ shuffle!

3. **Sample weighting:**
   - –ü–æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (–±–æ–ª–µ–µ –ª–∏–∫–≤–∏–¥–Ω—ã–µ = –±–æ–ª—å—à–∏–π –≤–µ—Å)

4. **–ö–≤–∞–Ω—Ç–∏–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏:**
   - q16, q50, q84 –¥–ª—è –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞

5. **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å:**
   - –û–¥–Ω–∞ –º–æ–¥–µ–ª—å –Ω–∞ –≤—Å–µ—Ö —Ç–∏–∫–µ—Ä–∞—Ö
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ticker_id` –∫–∞–∫ –ø—Ä–∏–∑–Ω–∞–∫ (‚ö†Ô∏è –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π)

---

# üìû –ü–†–û–í–ï–†–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–û–í

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```python
import pandas as pd
from pathlib import Path

# –≠—Ç–∞–ø 1
df = pd.read_parquet('data/processed/SBER_ohlcv_returns.parquet')
print(f"–≠—Ç–∞–ø 1: {len(df)} —Å—Ç—Ä–æ–∫, –∫–æ–ª–æ–Ω–∫–∏: {df.columns.tolist()}")

# –≠—Ç–∞–ø 2
df = pd.read_parquet('data/processed_ml/SBER_ml_features.parquet')
print(f"–≠—Ç–∞–ø 2: {len(df)} —Å—Ç—Ä–æ–∫, {len(df.columns)} –ø—Ä–∏–∑–Ω–∞–∫–æ–≤")
print(f"–ï—Å—Ç—å target: {'target_vol_5d' in df.columns}")

# –≠—Ç–∞–ø 3
from pathlib import Path
models_dir = Path('data/models')
print(f"–≠—Ç–∞–ø 3: –ú–æ–¥–µ–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç: {all((models_dir / f'global_lgbm_q{i}.txt').exists() for i in [16, 50, 84])}")
```

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏. üöÄ

