# üìú Scripts Directory

–ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—å—é –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏.

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### 1. run_full_pipeline.py
**–ü–æ–ª–Ω—ã–π pipeline: Feature Engineering ‚Üí Training ‚Üí Inference**

–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è.

```bash
# –ü–æ–ª–Ω—ã–π pipeline
python scripts/run_full_pipeline.py

# –° –≤—ã–±–æ—Ä–æ–º –ø—Ä–µ—Å–µ—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
python scripts/run_full_pipeline.py --preset MORE_TRAIN

# –¢–æ–ª—å–∫–æ –æ–±—É—á–µ–Ω–∏–µ (features —É–∂–µ –≥–æ—Ç–æ–≤—ã)
python scripts/run_full_pipeline.py --skip-features

# –¢–æ–ª—å–∫–æ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å (–º–æ–¥–µ–ª—å —É–∂–µ –æ–±—É—á–µ–Ω–∞)
python scripts/run_full_pipeline.py --skip-features --skip-training

# –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–∫–µ—Ä–∞
python scripts/run_full_pipeline.py --ticker GAZP
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--preset` - –ü—Ä–µ—Å–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (BASELINE, MORE_TRAIN, REGULARIZED, NO_TICKER)
- `--skip-features` - –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- `--skip-training` - –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
- `--ticker` - –¢–∏–∫–µ—Ä –¥–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ (default: SBER)
- `--no-intraday` - –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–∏–¥–Ω–µ–≤–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
- `--no-ensemble` - –¢–æ–ª—å–∫–æ LightGBM (–±–µ–∑ GARCH)

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `config/training_config.py`

---

### 2. validate_model.py
**–í–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏:
- –ö–∞–ª–∏–±—Ä–æ–≤–∫—É –∫–≤–∞–Ω—Ç–∏–ª–µ–π (Coverage)
- –¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ (MAE, RMSE, Correlation)
- –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ —Ç–∏–∫–µ—Ä–∞–º
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ look-ahead bias

```bash
python scripts/validate_model.py
```

**–í—ã—Ö–æ–¥:**
- –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- `reports/validation_detailed.csv` - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–∫–µ—Ä–∞–º
- `reports/validation_console.txt` - –ø–æ–ª–Ω—ã–π –ª–æ–≥ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

### 3. compare_models.py
**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π**

–°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ `validation_report.csv` —Ä–∞–∑–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤.

```bash
python scripts/compare_models.py
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ú–∏–Ω–∏–º—É–º 2 —Ñ–∞–π–ª–∞ `validation_report*.csv` –≤ `reports/`
- –î–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –æ—Ç—á—ë—Ç –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–º:
  ```bash
  copy reports\validation_report.csv reports\validation_report_baseline.csv
  ```

**–í—ã–≤–æ–¥–∏—Ç:**
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ (coverage, MAE, quantile losses)
- –õ—É—á—à—É—é –º–æ–¥–µ–ª—å –ø–æ –∫–∞–∂–¥–æ–π –º–µ—Ç—Ä–∏–∫–µ
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

---

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
scripts/
‚îú‚îÄ‚îÄ run_full_pipeline.py    # –ì–ª–∞–≤–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω
‚îú‚îÄ‚îÄ validate_model.py       # –í–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ compare_models.py       # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
‚îî‚îÄ‚îÄ README.md               # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—É—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ **–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ**: `config/training_config.py`

**–ß—Ç–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:**
- Train/Test split (–¥–∞—Ç–∞ cutoff)
- –ì–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã LightGBM (num_leaves, learning_rate, —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è)
- –ö–≤–∞–Ω—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞
- –ò—Å–∫–ª—é—á–∞–µ–º—ã–µ —Ç–∏–∫–µ—Ä—ã
- –ü—Ä–µ—Å–µ—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä:**
```python
# –í config/training_config.py
ACTIVE_PRESET = 'MORE_TRAIN'  # –∏–ª–∏ BASELINE, REGULARIZED, NO_TICKER

# –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–ø—Ä—è–º—É—é:
TRAIN_CUTOFF_DATE = '2024-06-01'  # –î–ª—è 70/30 split
LGBM_PARAMS = {
    'num_leaves': 63,
    'learning_rate': 0.05,
    'lambda_l1': 0.5,  # –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—é
    ...
}
```

---

## üîÑ –¢–∏–ø–∏—á–Ω—ã–π workflow

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   ```bash
   # –û—Ç–∫—Ä–æ–π—Ç–µ config/training_config.py
   # –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ—Å–µ—Ç –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—ã–π pipeline:**
   ```bash
   python scripts/run_full_pipeline.py --preset MORE_TRAIN
   ```

3. **–í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –º–æ–¥–µ–ª—å:**
   ```bash
   python scripts/validate_model.py
   ```

4. **–°—Ä–∞–≤–Ω–∏—Ç–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –º–æ–¥–µ–ª—å—é:**
   ```bash
   # –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –æ—Ç—á—ë—Ç
   copy reports\validation_report.csv reports\validation_report_old.csv
   
   # –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å
   python scripts/run_full_pipeline.py --preset REGULARIZED --skip-features
   
   # –°—Ä–∞–≤–Ω–∏—Ç–µ
   python scripts/compare_models.py
   ```

---

## üí° –°–æ–≤–µ—Ç—ã

- **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--skip-features`** –µ—Å–ª–∏ –ø—Ä–∏–∑–Ω–∞–∫–∏ —É–∂–µ –≥–æ—Ç–æ–≤—ã (—ç–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è)
- **–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å—Ç–∞—Ä—ã–µ –æ—Ç—á—ë—Ç—ã** –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ—Å–µ—Ç—ã** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏
- **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
